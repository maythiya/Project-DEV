{% load static %}
<!-- Navbar (partial) -->
<header
  x-data="{ open:false, scrolled:false }"
  x-init="
    scrolled = window.scrollY > 10;
    window.addEventListener('scroll', () => scrolled = window.scrollY > 10);
  "
  class="sticky top-0 z-40 border-b border-slate-200 transition"
  :class="scrolled ? 'bg-white/90 backdrop-blur-md shadow-sm' : 'bg-white/70 backdrop-blur'"
>
  <style>[x-cloak]{display:none!important}</style>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Top bar -->
    <div class="h-16 flex items-center justify-between">
      <!-- Brand -->
      <a href="{% url 'book_list' %}" class="flex items-center gap-2 group">
        <!-- กำหนดขนาด SVG ตายตัวกันจอยักษ์ -->
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2"
             class="text-blue-600 transition group-hover:scale-110">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 19.5A2.5 2.5 0 006.5 22H20"/>
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v13.5A2.5 2.5 0 016.5 20H20V6a2 2 0 00-2-2H6a2 2 0 00-2 2z"/>
        </svg>
        <span class="font-extrabold text-lg bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent">
          UBU Library
        </span>
      </a>

      <!-- Desktop nav -->
      {% with request.resolver_match.url_name as current %}
      <nav class="hidden md:flex items-center gap-6">
        <a href="{% url 'book_list' %}"
           class="text-sm font-medium hover:text-blue-600"
           :class="{'text-blue-700 underline underline-offset-4': false}">
          หน้าแรก
        </a>
        <a href="{% url 'my_loans' %}"
           class="text-sm font-medium hover:text-blue-600 {% if current == 'my_loans' %}text-blue-700 underline underline-offset-4{% endif %}">
          ยืมของฉัน
        </a>
        {% if user.is_staff %}
          <a href="{% url 'book_manage_list' %}"
             class="text-sm font-medium hover:text-blue-600 {% if current == 'book_manage_list' %}text-blue-700 underline underline-offset-4{% endif %}">
            จัดการหนังสือ
          </a>
          <a href="{% url 'dashboard' %}"
             class="text-sm font-medium hover:text-blue-600 {% if current == 'dashboard' %}text-blue-700 underline underline-offset-4{% endif %}">
            สถิติ
          </a>
        {% endif %}
      </nav>

      <!-- Desktop actions -->
      <div class="hidden md:flex items-center gap-3">
        {% if user.is_authenticated %}
          <div class="flex items-center gap-2">
            <div class="w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-slate-700 text-xs font-semibold">
              {{ user.username|slice:":1"|upper }}
            </div>
            <span class="text-sm text-slate-600">สวัสดี, <span class="font-medium">{{ user.username }}</span></span>
          </div>
          <form method="post" action="{% url 'logout' %}">
            {% csrf_token %}
            <button class="px-3 py-1.5 rounded-lg bg-slate-900 text-white hover:bg-slate-800 transition">
              ออกจากระบบ
            </button>
          </form>
          <form method="post" action="{% url 'delete_account' %}" onsubmit="return confirm('คุณแน่ใจว่าต้องการลบบัญชีผู้ใช้? การดำเนินการนี้ไม่สามารถย้อนกลับได้');">
            {% csrf_token %}
            <button class="px-3 py-1.5 rounded-lg bg-red-600 text-white hover:bg-red-700 transition">
              ลบบัญชี
            </button>
          </form>
        {% else %}
          <a href="{% url 'login' %}"
             class="px-3 py-1.5 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition">
            เข้าสู่ระบบ
          </a>
          <a href="{% url 'register' %}"
             class="px-3 py-1.5 rounded-lg bg-slate-200 hover:bg-slate-300 transition">
            สมัครสมาชิก
          </a>
        {% endif %}
      </div>
      {% endwith %}

      <!-- Mobile toggle -->
      <button class="md:hidden p-2 rounded-lg hover:bg-slate-100"
              @click="open = !open" aria-label="Toggle menu">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
             stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>
    </div>

    <!-- Mobile menu -->
    <div x-cloak x-show="open" x-collapse class="md:hidden pb-4">
      <nav class="space-y-2">
        <a href="{% url 'book_list' %}" class="block px-3 py-2 rounded-lg hover:bg-slate-100">หน้าแรก</a>
        <a href="{% url 'my_loans' %}" class="block px-3 py-2 rounded-lg hover:bg-slate-100">ยืมของฉัน</a>
        {% if user.is_staff %}
          <a href="{% url 'book_manage_list' %}" class="block px-3 py-2 rounded-lg hover:bg-slate-100">จัดการหนังสือ</a>
          <a href="{% url 'dashboard' %}" class="block px-3 py-2 rounded-lg hover:bg-slate-100">สถิติ</a>
        {% endif %}
        <div class="pt-2 border-t">
          {% if user.is_authenticated %}
            <form method="post" action="{% url 'logout' %}" class="px-3">
              {% csrf_token %}
              <button class="w-full px-3 py-2 rounded-lg bg-slate-900 text-white">ออกจากระบบ</button>
            </form>
          {% else %}
            <a href="{% url 'login' %}" class="block px-3 py-2 rounded-lg bg-blue-600 text-white">เข้าสู่ระบบ</a>
            <a href="{% url 'register' %}" class="block px-3 py-2 rounded-lg bg-slate-200">สมัครสมาชิก</a>
          {% endif %}
        </div>
      </nav>
    </div>
  </div>
</header>
